<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>404 - Page Not Found</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');

    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body,
    html {
      height: 100%;
      background: #000;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      overflow: hidden;
    }

    .container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    /* 404 PAGE */
    .page-404 {
      display: none;
      width: 100%;
      height: 100%;
    }

    .page-404.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .content-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1200px;
      width: 90%;
      padding: 40px;
    }

    .text-section {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .error-code {
      font-size: clamp(4rem, 12vw, 8rem);
      font-weight: 800;
      line-height: 1;
      margin-bottom: 20px;
      letter-spacing: -2px;
      position: relative;
      text-shadow:
        -2px -2px 0 rgba(255, 0, 0, 0.7),
        2px 2px 0 rgba(0, 255, 255, 0.7),
        -4px 0 0 rgba(255, 0, 255, 0.5),
        4px 0 0 rgba(0, 255, 0, 0.5);
      animation: glitch-effect 2s infinite;
    }

    @keyframes glitch-effect {
      0% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
      }

      20% {
        text-shadow:
          -3px -3px 0 rgba(255, 0, 0, 0.8),
          3px 3px 0 rgba(0, 255, 255, 0.8),
          -6px 0 0 rgba(255, 0, 255, 0.6),
          6px 0 0 rgba(0, 255, 0, 0.6);
        transform: translate(-1px, 1px);
      }

      40% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(0, 0);
      }

      60% {
        text-shadow:
          2px 2px 0 rgba(255, 0, 0, 0.7),
          -2px -2px 0 rgba(0, 255, 255, 0.7),
          4px 0 0 rgba(255, 0, 255, 0.5),
          -4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(1px, -1px);
      }

      100% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(0, 0);
      }
    }

    .error-title {
      font-size: clamp(1.8rem, 4vw, 2.8rem);
      font-weight: 700;
      margin-bottom: 15px;
      line-height: 1.2;
      position: relative;
      text-shadow:
        -2px -2px 0 rgba(255, 0, 0, 0.7),
        2px 2px 0 rgba(0, 255, 255, 0.7),
        -4px 0 0 rgba(255, 0, 255, 0.5),
        4px 0 0 rgba(0, 255, 0, 0.5);
      animation: glitch-effect-title 2s infinite;
    }

    @keyframes glitch-effect-title {
      0% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
      }

      20% {
        text-shadow:
          -3px -3px 0 rgba(255, 0, 0, 0.8),
          3px 3px 0 rgba(0, 255, 255, 0.8),
          -6px 0 0 rgba(255, 0, 255, 0.6),
          6px 0 0 rgba(0, 255, 0, 0.6);
        transform: translate(-1px, 1px);
      }

      40% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(0, 0);
      }

      60% {
        text-shadow:
          2px 2px 0 rgba(255, 0, 0, 0.7),
          -2px -2px 0 rgba(0, 255, 255, 0.7),
          4px 0 0 rgba(255, 0, 255, 0.5),
          -4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(1px, -1px);
      }

      100% {
        text-shadow:
          -2px -2px 0 rgba(255, 0, 0, 0.7),
          2px 2px 0 rgba(0, 255, 255, 0.7),
          -4px 0 0 rgba(255, 0, 255, 0.5),
          4px 0 0 rgba(0, 255, 0, 0.5);
        transform: translate(0, 0);
      }
    }

    .error-desc {
      font-size: clamp(0.95rem, 2vw, 1.1rem);
      color: #ccc;
      margin-bottom: 30px;
      line-height: 1.6;
      max-width: 500px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 14px 32px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      font-weight: 600;
      border: 2px solid #fff;
      background: transparent;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.5px;
    }

    .btn:hover {
      background: #fff;
      color: #000;
    }

    .btn-secondary {
      border-color: #666;
      color: #999;
    }

    .btn-secondary:hover {
      border-color: #fff;
      color: #fff;
      background: transparent;
    }

    .btn-threat {
      border-color: #fff;
      color: #fff;
      animation: pulse-border 2s infinite;
    }

    @keyframes pulse-border {

      0%,
      100% {
        border-color: #fff;
      }

      50% {
        border-color: #ccc;
      }
    }

    .model-section {
      position: relative;
      height: 100%;
      min-height: 500px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #canvas3d {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* GAME PAGE - FULL SCREEN */
    .page-threat {
      display: none;
      width: 100%;
      height: 100%;
      position: relative;
    }

    .page-threat.active {
      display: block;
    }

    #gameCanvasFull {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
      cursor: none;
    }

    /* Game UI Overlay */
    .game-ui {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
    }

    /* Top HUD */
    .game-hud-top {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 101;
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      font-weight: 700;
      letter-spacing: 1px;
    }

    .hud-title {
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .hud-nav {
      display: flex;
      gap: 10px;
      pointer-events: all;
    }

    .hud-btn {
      padding: 6px 14px;
      font-size: 0.8rem;
      border: 1px solid #666;
      background: transparent;
      color: #999;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }

    .hud-btn:hover {
      border-color: #fff;
      color: #fff;
    }

    /* Bottom HUD */
    .game-hud-bottom {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 30px;
      justify-content: center;
      z-index: 101;
      font-size: clamp(0.9rem, 2vw, 1rem);
      font-weight: 700;
    }

    .hud-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      padding: 12px 20px;
      border: 1px solid #333;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      letter-spacing: 0.5px;
    }

    .stat-label {
      color: #888;
      font-size: 0.8em;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 1.4em;
      color: #fff;
    }

    /* Center Message */
    .game-center-msg {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 102;
      pointer-events: none;
    }

    .msg-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 15px;
      letter-spacing: -1px;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    .msg-subtitle {
      font-size: clamp(1rem, 2.5vw, 1.3rem);
      color: #bbb;
      letter-spacing: 0.5px;
    }

    /* Game Over Overlay */
    .game-over-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 25px;
      z-index: 200;
    }

    .game-over-overlay.show {
      display: flex;
    }

    .game-over-title {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 800;
      letter-spacing: -1px;
      text-align: center;
    }

    .game-over-stats {
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: #bbb;
      text-align: center;
    }

    .game-over-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      pointer-events: all;
    }

    .btn-over {
      padding: 12px 32px;
      font-size: 0.95rem;
      font-weight: 600;
      border: 2px solid #fff;
      background: #fff;
      color: #000;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    .btn-over:hover {
      background: transparent;
      color: #fff;
    }

    .btn-over.secondary {
      background: transparent;
      border-color: #666;
      color: #999;
    }

    .btn-over.secondary:hover {
      border-color: #fff;
      color: #fff;
    }

    /* Crosshair cursor */
    .game-cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      border: 2px solid #fff;
      border-radius: 50%;
      pointer-events: none;
      z-index: 300;
      display: none;
    }

    .game-cursor.show {
      display: block;
    }

    @media (max-width:768px) {
      .hud-nav {
        flex-direction: column;
        gap: 5px;
      }

      .game-hud-bottom {
        gap: 15px;
        bottom: 20px;
      }

      .game-hud-top {
        top: 10px;
        padding: 0 10px;
      }

      .hud-title {
        font-size: 1rem;
      }

      .hud-btn {
        padding: 8px 16px;
        font-size: 0.9rem;
      }

      .game-center-msg {
        top: 40%;
        font-size: 0.9rem;
      }

      .msg-title {
        font-size: clamp(1.5rem, 4vw, 2.5rem);
      }

      .msg-subtitle {
        font-size: clamp(0.8rem, 2vw, 1.2rem);
      }

      .game-over-title {
        font-size: clamp(2rem, 5vw, 3rem);
      }

      .game-over-stats {
        font-size: clamp(0.9rem, 2vw, 1.2rem);
      }

      .btn-over {
        padding: 10px 24px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 404 PAGE -->
    <div class="page-404 active">
      <div class="content-wrapper">
        <div class="text-section">
          <div class="error-code">404</div>
          <h1 class="error-title">Men At Work!!!</h1>
          <p class="error-desc">
            The page you're looking for doesn't exist or has been moved.
            Let's get you back on track.
          </p>
          <div class="button-group">
            <button class="btn btn-threat" onclick="startThreatDetection()">üéÆ Play Game</button>
            <button class="btn btn-secondary" onclick="window.location.href='/templates/index.html'">‚Üê Go To
              Home</button>
          </div>
        </div>

        <div class="model-section">
          <canvas id="canvas3d"></canvas>
        </div>
      </div>
    </div>

    <!-- GAME PAGE - FULL SCREEN ARENA -->
    <div class="page-threat">
      <canvas id="gameCanvasFull"></canvas>

      <!-- Game UI -->
      <div class="game-ui">
        <!-- Top HUD -->
        <div class="game-hud-top">
          <div class="hud-title">NETWORK DEFENSE</div>
          <div class="hud-nav">
            <button class="hud-btn" onclick="backTo404()">‚Üê Go Back</button>
            <button class="hud-btn" onclick="window.location.href='/'">Home</button>
          </div>
        </div>

        <!-- Center Message -->
        <div class="game-center-msg" id="centerMsg">
          <div class="msg-title" id="centerTitle">Protect Your System</div>
          <div class="msg-subtitle" id="centerSubtitle">Press Space or ‚Üë to start...</div>
        </div>

        <!-- Bottom HUD -->
        <div class="game-hud-bottom">
          <div class="hud-stat">
            <span class="stat-label">Score</span>
            <span class="stat-value" id="scoreHUD">0</span>
          </div>
          <div class="hud-stat">
            <span class="stat-label">Survival</span>
            <span class="stat-value" id="distanceHUD">0s</span>
          </div>
          <div class="hud-stat">
            <span class="stat-label">Health</span>
            <span class="stat-value" id="healthHUD">100%</span>
          </div>
        </div>
      </div>

      <!-- Game Over Overlay -->
      <div class="game-over-overlay" id="gameOverOverlay">
        <div class="game-over-title">SYSTEM COMPROMISED</div>
        <div class="game-over-stats">
          <div>Final Score: <span id="finalScore">0</span></div>
          <div>Distance Traveled: <span id="finalDistance">0</span>m</div>
        </div>
        <div class="game-over-buttons">
          <button class="btn-over" onclick="restartGame()">üîÑ Try Again</button>
          <button class="btn-over secondary" onclick="backTo404()">‚Üê Back to 404</button>
        </div>
      </div>

      <!-- Cursor -->
      <div class="game-cursor" id="gameCursor"></div>
    </div>
  </div>

  <script>
    // ===== 3D SCENE FOR 404 PAGE =====
    let scene, camera, renderer, model;
    const canvas3d = document.getElementById('canvas3d');

    function init3D() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      camera = new THREE.PerspectiveCamera(
        75,
        canvas3d.clientWidth / canvas3d.clientHeight,
        0.1,
        1000
      );
      camera.position.z = 4;

      renderer = new THREE.WebGLRenderer({ canvas: canvas3d, antialias: true, alpha: true });
      renderer.setSize(canvas3d.clientWidth, canvas3d.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.shadowMap.enabled = true;

      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(5, 5, 5);
      directionalLight.castShadow = true;
      scene.add(directionalLight);

      const pointLight = new THREE.PointLight(0xffffff, 0.4);
      pointLight.position.set(-5, -5, 5);
      scene.add(pointLight);

      createBrokenModel();
      window.addEventListener('resize', onWindowResize3D);
      animate3D();
    }

    function createBrokenModel() {
      const group = new THREE.Group();

      const cubeGeometry = new THREE.BoxGeometry(2, 2, 2);
      const cubeMaterial = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        wireframe: false,
        emissive: 0x333333,
      });
      const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
      cube.castShadow = true;
      group.add(cube);

      const wireframeGeometry = new THREE.BoxGeometry(2.1, 2.1, 2.1);
      const wireframeMaterial = new THREE.MeshBasicMaterial({
        wireframe: true,
        color: 0x666666,
      });
      const wireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
      group.add(wireframe);

      const particlesGeometry = new THREE.BufferGeometry();
      const particleCount = 50;
      const positions = new Float32Array(particleCount * 3);

      for (let i = 0; i < particleCount * 3; i += 3) {
        positions[i] = (Math.random() - 0.5) * 6;
        positions[i + 1] = (Math.random() - 0.5) * 6;
        positions[i + 2] = (Math.random() - 0.5) * 6;
      }

      particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

      const particlesMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.05,
        sizeAttenuation: true,
        opacity: 0.6,
      });

      const particles = new THREE.Points(particlesGeometry, particlesMaterial);
      group.add(particles);

      group.userData.particles = particles;
      group.userData.cube = cube;

      scene.add(group);
      model = group;
    }

    function animate3D() {
      requestAnimationFrame(animate3D);

      if (model) {
        model.rotation.x += 0.003;
        model.rotation.y += 0.005;

        const scale = 1 + Math.sin(Date.now() * 0.001) * 0.05;
        model.scale.set(scale, scale, scale);

        if (model.userData.particles) {
          model.userData.particles.rotation.x += 0.001;
          model.userData.particles.rotation.y += 0.002;
        }
      }

      renderer.render(scene, camera);
    }

    function onWindowResize3D() {
      const width = canvas3d.clientWidth;
      const height = canvas3d.clientHeight;
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
    }

    // ===== FULL-SCREEN EDGE-STYLE GAME =====
    const gameCanvas = document.getElementById('gameCanvasFull');
    const gameCtx = gameCanvas.getContext('2d');
    const cursor = document.getElementById('gameCursor');

    let gameState = {
      score: 0,
      distance: 0,
      health: 100,
      gameRunning: false,
      gameOver: false,
      computerX: window.innerWidth / 2,
      computerY: window.innerHeight / 2,
      computerSize: 40,
      moveDirection: { x: 0, y: 0 },
      threats: [],
      spawnRate: 100,
      survivalTime: 0,
      lastComputerX: window.innerWidth / 2,
      lastComputerY: window.innerHeight / 2,
      whiteThreatsCollected: 0
    };

    function resizeGameCanvas() {
      gameCanvas.width = window.innerWidth;
      gameCanvas.height = window.innerHeight;
    }

    function startThreatDetection() {
      document.querySelector('.page-404').classList.remove('active');
      document.querySelector('.page-threat').classList.add('active');
      resizeGameCanvas();
      cursor.classList.add('show');
      initGame();
    }

    function initGame() {
      gameState = {
        score: 0,
        distance: 0,
        health: 100,
        gameRunning: false,
        gameOver: false,
        computerX: window.innerWidth / 2,
        computerY: window.innerHeight / 2,
        computerSize: 40,
        moveDirection: { x: 0, y: 0 },
        threats: [],
        spawnRate: 100,
        survivalTime: 0,
        lastComputerX: window.innerWidth / 2,
        lastComputerY: window.innerHeight / 2,
        whiteThreatsCollected: 0
      };

      document.getElementById('gameOverOverlay').classList.remove('show');
      document.getElementById('centerTitle').textContent = 'Protect Your System';
      document.getElementById('centerSubtitle').textContent = 'Press Space or Arrow Keys to start...';
      updateGameStats();

      window.addEventListener('keydown', handleKeyPress);
      window.addEventListener('keyup', handleKeyUp);
      window.addEventListener('mousemove', updateCursor);
      window.addEventListener('resize', resizeGameCanvas);

      gameLoop();
    }

    function updateCursor(e) {
      cursor.style.left = (e.clientX - 10) + 'px';
      cursor.style.top = (e.clientY - 10) + 'px';
    }

    function handleKeyPress(e) {
      if ((e.key === ' ' || e.key === 'ArrowUp') && !gameState.gameRunning && !gameState.gameOver) {
        e.preventDefault();
        gameState.gameRunning = true;
        document.getElementById('centerMsg').style.display = 'none';
      }
      if (gameState.gameRunning) {
        if (e.key === 'ArrowUp' || e.key === ' ') gameState.moveDirection.y = -1;
        if (e.key === 'ArrowDown') gameState.moveDirection.y = 1;
        if (e.key === 'ArrowLeft') gameState.moveDirection.x = -1;
        if (e.key === 'ArrowRight') gameState.moveDirection.x = 1;
      }
    }

    function handleKeyUp(e) {
      if (e.key === 'ArrowUp' || e.key === ' ') gameState.moveDirection.y = 0;
      if (e.key === 'ArrowDown') gameState.moveDirection.y = 0;
      if (e.key === 'ArrowLeft') gameState.moveDirection.x = 0;
      if (e.key === 'ArrowRight') gameState.moveDirection.x = 0;
    }

    function spawnThreat() {
      const threatSize = 30;
      gameState.threats.push({
        x: Math.random() * gameCanvas.width,
        y: Math.random() * gameCanvas.height,
        size: threatSize,
        vx: 0,
        vy: 0,
        targetX: gameState.lastComputerX,
        targetY: gameState.lastComputerY,
        hasTarget: true,
        isWhite: false,
        frozenTime: 0
      });
    }

    function updateGame() {
      if (!gameState.gameRunning) return;

      // Computer movement
      const speed = 5;
      gameState.computerX += gameState.moveDirection.x * speed;
      gameState.computerY += gameState.moveDirection.y * speed;

      // Boundaries
      const margin = gameState.computerSize;
      gameState.computerX = Math.max(margin, Math.min(gameCanvas.width - margin, gameState.computerX));
      gameState.computerY = Math.max(margin, Math.min(gameCanvas.height - margin, gameState.computerY));

      // Store current position for threat targeting
      gameState.lastComputerX = gameState.computerX;
      gameState.lastComputerY = gameState.computerY;

      // Spawn threats
      gameState.spawnRate--;
      if (gameState.spawnRate <= 0) {
        spawnThreat();
        gameState.spawnRate = Math.max(50, 100 - gameState.survivalTime / 100);
      }

      // Move threats - TRACK POSITION ONLY, NOT CONTINUOUS TRACKING
      for (let i = gameState.threats.length - 1; i >= 0; i--) {
        const threat = gameState.threats[i];

        // If threat still has target position
        if (threat.hasTarget) {
          const dx = threat.targetX - threat.x;
          const dy = threat.targetY - threat.y;
          const distance = Math.sqrt(dx * dx + dy * dy);

          // Move towards target position at constant speed
          const threatSpeed = 1.5 + gameState.survivalTime / 500;

          if (distance > threatSpeed) {
            threat.vx = (dx / distance) * threatSpeed;
            threat.vy = (dy / distance) * threatSpeed;
            threat.x += threat.vx;
            threat.y += threat.vy;
          } else {
            // Reached target position - TURN WHITE and STOP
            threat.hasTarget = false;
            threat.vx = 0;
            threat.vy = 0;
            threat.isWhite = true;
            threat.frozenTime = 0;
          }
        } else {
          // Threat is frozen (white)
          threat.frozenTime++;
        }

        // Check if threat goes off screen
        if (threat.x < -100 || threat.x > gameCanvas.width + 100 ||
          threat.y < -100 || threat.y > gameCanvas.height + 100) {
          gameState.threats.splice(i, 1);
        } else if (checkCollision(threat)) {
          if (threat.isWhite) {
            // Eating white threat = score increase
            gameState.threats.splice(i, 1);
            gameState.score += 50;
            gameState.whiteThreatsCollected++;

            // Every 2 white threats = 10% health increase
            if (gameState.whiteThreatsCollected % 2 === 0) {
              gameState.health = Math.min(100, gameState.health + 10);
            }
          } else {
            // Collision with red threat = health damage
            gameState.threats.splice(i, 1);
            gameState.health -= 15;
            if (gameState.health <= 0) {
              endGame();
            }
          }
        }
      }

      // Increase survival time
      gameState.survivalTime += 1;
      gameState.distance = Math.floor(gameState.survivalTime / 60); // Convert frames to seconds
      updateGameStats();
    }

    function checkCollision(threat) {
      const dx = gameState.computerX - threat.x;
      const dy = gameState.computerY - threat.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      return distance < gameState.computerSize + threat.size;
    }

    // Add this before the gameLoop function
    const systemImg = new Image();
    systemImg.src = '/assets/system.png';

    const threatImg = new Image();
    threatImg.src = '/assets/download.png';

    function drawGame() {
      gameCtx.fillStyle = '#000';
      gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);

      // Grid background
      gameCtx.strokeStyle = '#0a0a0a';
      gameCtx.lineWidth = 1;
      for (let i = 0; i < gameCanvas.width; i += 60) {
        gameCtx.beginPath();
        gameCtx.moveTo(i, 0);
        gameCtx.lineTo(i, gameCanvas.height);
        gameCtx.stroke();
      }
      for (let i = 0; i < gameCanvas.height; i += 60) {
        gameCtx.beginPath();
        gameCtx.moveTo(0, i);
        gameCtx.lineTo(gameCanvas.width, i);
        gameCtx.stroke();
      }

      // ===== COMPUTER (SYSTEM) - SYSTEM.PNG IMAGE =====
      if (systemImg.complete && systemImg.naturalHeight > 0) {
        const sysSize = 100;
        gameCtx.drawImage(systemImg, gameState.computerX - sysSize / 2, gameState.computerY - sysSize / 2, sysSize, sysSize);
      }

      // ===== THREATS - DOWNLOAD.PNG IMAGE =====
      for (let threat of gameState.threats) {
        if (threatImg.complete && threatImg.naturalHeight > 0) {
          const threatDisplaySize = threat.size * 3.5;
          gameCtx.drawImage(threatImg, threat.x - threatDisplaySize / 2, threat.y - threatDisplaySize / 2, threatDisplaySize, threatDisplaySize);
        }
      }
    }

    function gameLoop() {
      updateGame();
      drawGame();

      if (!gameState.gameOver) {
        requestAnimationFrame(gameLoop);
      }
    }

    function updateGameStats() {
      document.getElementById('scoreHUD').textContent = gameState.score;
      document.getElementById('distanceHUD').textContent = gameState.distance + 's';
      document.getElementById('healthHUD').textContent = Math.max(0, gameState.health) + '%';
    }

    function endGame() {
      gameState.gameRunning = false;
      gameState.gameOver = true;
      document.getElementById('finalScore').textContent = gameState.score;
      document.getElementById('finalDistance').textContent = gameState.distance + 's';
      document.getElementById('gameOverOverlay').classList.add('show');
    }

    function restartGame() {
      gameState.gameOver = false;
      document.getElementById('gameOverOverlay').classList.remove('show');
      document.getElementById('centerMsg').style.display = 'block';
      initGame();
    }

    function backTo404() {
      gameState.gameRunning = false;
      gameState.gameOver = false;
      cursor.classList.remove('show');
      window.removeEventListener('keydown', handleKeyPress);
      window.removeEventListener('keyup', handleKeyUp);
      window.removeEventListener('mousemove', updateCursor);
      window.removeEventListener('resize', resizeGameCanvas);
      document.querySelector('.page-threat').classList.remove('active');
      document.querySelector('.page-404').classList.add('active');
    }

    window.addEventListener('load', init3D);
  </script>
</body>

</html>